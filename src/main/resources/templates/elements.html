<!DOCTYPE html>


<th:block th:fragment="top-bar"  th:object="${currentUser}">
    <header class="sticky-top navbar navbar-expand flex-md-row justify-content-between navbar-dark bg-dark">
        <div class="navbar-brand">
            <span  th:text="*{email} + ' with roles: '"></span>
            <th:block th:each="role : *{roles}">
                <span th:if="${role.getRolename()} == 'ROLE_ADMIN'" th:text="'ADMIN'"> VALUE</span>
                <span th:unless="${role.getRolename()} == 'ROLE_ADMIN'" th:text="'USER'"> VALUE</span>
            </th:block>
        </div>
        <div class="nav nav-pills"><a th:href="@{/logout}" class="nav-item nav-link btn text-secondary">Log Out</a></div>
    </header>
</th:block>

<div th:fragment="side-bar" th:object="${currentUser}" class="col-2 pt-1 bd-sidebar list-group bg-white">
    <th:block th:each="role : *{roles}">
        <a class="list-group-item list-group-item-action active" th:if="${role.getRolename()} == 'ROLE_ADMIN'" th:href="@{/admin}" th:text="'ADMIN'"></a>
        <a class="list-group-item list-group-item-action" th:unless="${role.getRolename()} == 'ROLE_ADMIN'" th:href="@{/user}" th:text="'USER'"></a>
    </th:block>
</div>

<table class="table table-striped" id="users-table" th:fragment="all-users-table" th:object="${users}">
    <caption>All users</caption>
    <thead>
    <tr>
        <th>ID</th>
        <th>Login</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Email</th>
        <th>Edit</th>
        <th >Delete</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="user : ${users}">
        <td th:text="${user.getId()}"></td>
        <td th:text="${user.getUsername()}"></td>
        <td th:text="${user.getFirstName()}"></td>
        <td th:text="${user.getLastName()}"></td>
        <td th:text="${user.getEmail()}"></td>
        <td><a th:href="@{admin/edit-user(id=${user.getId()})}" title="Edit user details" class="btn btn-info">Edit</a></td>
        <td><a th:href="@{admin/delete-user(id=${user.getId()})}" title="Delete user" class="btn btn-danger">Delete</a></td>
    </tr>
    </tbody>
</table>

<form class="col-4 bg-white no-gutters align-items-start container-fluid" th:fragment="save-user-details-form" th:action="'#'" th:method="post" th:object="${user}">
    <legend class="h4"
            th:text="*{id} == null ? 'Add new user' : 'Edit user'"></legend>
    <fieldset>
        <div class="form-group text-center">
            <label class="mb-0" for="username"><strong>Username</strong></label>
            <input th:type="text"
                   th:disabled="*{id} == null ? false : true"
                   th:required="*{id} == null ? true : false"
                   class="form-control"
                   id="username"
                   th:field="*{username}"
                   th:placeholder="*{id} == null ? 'Choose wisely.' : *{username}"/>
            <span class="error bg-warning text-dark"
                  th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></span>
        </div>
        <div class="form-group text-center align-bottom">
            <label class="mb-0" for="firstname"><strong>First name</strong></label>
            <input type="text"
                   th:required="*{id} == null ? true : false"
                   class="form-control"
                   id="firstname"
                   th:field="*{firstName}"
                   th:placeholder="*{id} == null ? 'How does your mama call you?' : *{firstName}"/>
            <span class="error bg-warning text-dark" th:if="${#fields.hasErrors('firstName')}"
                  th:errors="*{firstName}"></span>
        </div>
        <div class="form-group text-center">
            <label class="mb-0" for="lastname"><strong>Last name</strong></label>
            <input type="text"
                   class="form-control"
                   id="lastname"
                   th:field="*{lastName}"
                   th:placeholder="*{id} == null ? 'To which kin dost thou belong?' : *{lastName}"/>
            <span class="error bg-warning text-dark" th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}"></span>
        </div>

        <div class="form-group text-center">
            <label class="mb-0" for="email"><strong>Email</strong></label>
            <input type="text"
                   th:required="*{id} == null ? true : false"
                   class="form-control"
                   id="email"
                   th:field="*{email}"
                   th:placeholder="*{id} == null ? 'Where shall we send an owl?' : *{email}"/>
            <span class="error bg-warning text-dark" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></span>
        </div>

        <div class="form-group text-center">
            <label class="mb-0" for="password"><strong>Password</strong></label>
            <input th:type="*{id} == null ? text : hidden"
                   th:required="*{id} == null ? true : false"
                   class="form-control"
                   id="password"
                   th:field="*{password}"
                   placeholder="Be sneaky."/>
            <span class="error bg-warning text-dark" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></span>
        </div>
        <div class="form-group text-center">
            <label class="mb-0" for="role"><strong>Role</strong></label>
            <select multiple="multiple"
                    class="form-control"
                    th:size="2"
                    name="roles"
                    id="role"
                    th:field="*{roles}">
                <option th:each="role : ${allRoles}"
                        th:value="${{role.id}}"
                        th:text="${role.getRolename()}">
                </option>
            </select>
        </div>
    </fieldset>
    <input type="submit"
           class="btn btn-success mb-2"
           name="submit"
           id="submit"
           th:value="*{id} == null ? 'Add new user' : 'Edit user'"
           th:formaction="*{id} == null ? @{/admin/create-user} : @{/admin/edit-user(id=${user.getId()})}">

</form>
